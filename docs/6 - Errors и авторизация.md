## Обработка ошибок express
- Все сервисы должны одинаково обрабатывать ошибки => пишем общий обработчик ошибок
- И эти ошибки не только валидация. Все эти варианты нужно правильно обрабатывать => обработка всех возможных ошибок 
- Создаем реализацию от Error со своей структурой. Под каждый тип ошибок - свой Error. + Для неизветных ошибок делаем generic обработку

## Авторизация в mircorservices
- Авторизация в микросервисах - это ансолвд проблема
- Вариант 1: делать sync запрос в сервис авторизации. Падает сервис - падают юзеры.
- Вариант 2: гейт в видет AuthService. Падает сервис - сервисы не получают запросы.
- Вариант 3: каждый сервис знает как проверить юзера с помощью shared логики. Проблема с контролем сессии. Как нам забанить юзера? Все сервисы не знают об этом бане, только AuthService.

Как решить проблему 3 варианта?
- Хранить expire и делать рефреш JWT через AuthService синхронно или асинхронно отдавая reject по http
- Отправлять event из AuthService в EventQueue и в сервисах хранить в памяти статусы юзеров

JWT или Cookie?
- JWT - механизм авторизации/аутентификации, хранит данные, обрабатываем ручками
- Cookie - транспортный механизм, отправляет любые данные меж клиентом и сервером, автоматически обрабатывается браузером

Что нам нужно?
- говорит нам детали а юзере
- иметь безопасный механизм удаления и expire 
- крос язычность и доступность
- не нужно хранить данные на бэке

Это все JWT

Теперь про куксы:
1. Энкриптинг куксов меж языками достаточно сложная задача
2. Поэтому мы не будет их энкриптить
3. Ведь jwt делает это за нас

https://jwt.io/ - щупаем jwt

JWT состоит из payload и signing key (ключ, который должен быть доступен всем сервисам)

НЕ ХРАНИТЕ ЭТОТ КЛЮЧ В КОДЕ!

Как это сделать?

В кубере есть Secrets!
Чтоб его задать используем:

`kubectl create secret generic jwt-secret --from-literal=JWT_KEY=your_key`

Теперь в конфигах yml мы можем обратиться к этом секрету.

```yml
   spec:
      containers:
          - name: auth
            image: ghc.io/auth
            env: 
              - name: JWT_KEY # имя в env данного контейнера
                valueFrom: 
                  secretKeyRef: 
                    name: jwt-secret
                    key: JWT_KEY
```
